<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Dashboard - MediCare</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        .debug-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: #f7fafc;
        }
        .debug-section h3 {
            color: #4a5568;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .status {
            padding: 10px 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 500;
        }
        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }
        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #fc8181;
        }
        .status.warning {
            background: #fefcbf;
            color: #744210;
            border: 1px solid #f6e05e;
        }
        .button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
        .button.secondary {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
        }
        .button.danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 10px 0;
        }
        .info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 15px 0;
        }
        .info-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        .info-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 5px;
        }
        .info-value {
            color: #2d3748;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Debug Dashboard MediCare</h1>
        
        <div class="debug-section">
            <h3>üîç Verifica√ß√£o de Autentica√ß√£o</h3>
            <div id="auth-status">Verificando...</div>
            <button class="button" onclick="checkAuth()">Verificar Autentica√ß√£o</button>
            <button class="button secondary" onclick="createTestUser()">Criar Usu√°rio Teste</button>
            <button class="button danger" onclick="clearAuth()">Limpar Autentica√ß√£o</button>
        </div>

        <div class="debug-section">
            <h3>üìä Status do Dashboard</h3>
            <div id="dashboard-status">Verificando...</div>
            <button class="button" onclick="testDashboard()">Testar Dashboard</button>
            <a href="http://localhost:8080/" target="_blank" class="button secondary">Abrir Dashboard</a>
        </div>

        <div class="debug-section">
            <h3>üåê Informa√ß√µes do Sistema</h3>
            <div id="system-info">Carregando...</div>
        </div>

        <div class="debug-section">
            <h3>üîß A√ß√µes de Corre√ß√£o</h3>
            <button class="button" onclick="fixAuthIssues()">Corrigir Problemas de Auth</button>
            <button class="button secondary" onclick="resetSystem()">Reset Completo</button>
        </div>

        <div class="debug-section">
            <h3>üìù Log de Debug</h3>
            <div id="debug-log" class="code-block">Aguardando a√ß√µes...</div>
        </div>
    </div>

    <script>
        let debugLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            debugLog.push(logEntry);
            
            const logElement = document.getElementById('debug-log');
            logElement.textContent = debugLog.slice(-10).join('\n');
            
            console.log(logEntry);
        }

        function checkAuth() {
            log('Verificando autentica√ß√£o...', 'info');
            
            const user = localStorage.getItem('user');
            const authStatusDiv = document.getElementById('auth-status');
            
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    log(`Usu√°rio encontrado: ${userData.name}`, 'success');
                    
                    authStatusDiv.innerHTML = `
                        <div class="status success">‚úÖ Usu√°rio autenticado</div>
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label">Nome:</div>
                                <div class="info-value">${userData.name}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Email:</div>
                                <div class="info-value">${userData.email}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Fun√ß√£o:</div>
                                <div class="info-value">${userData.role}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Hospital:</div>
                                <div class="info-value">${userData.hospital}</div>
                            </div>
                        </div>
                    `;
                } catch (error) {
                    log(`Erro ao parsear dados do usu√°rio: ${error.message}`, 'error');
                    authStatusDiv.innerHTML = '<div class="status error">‚ùå Dados de usu√°rio corrompidos</div>';
                }
            } else {
                log('Nenhum usu√°rio autenticado encontrado', 'warning');
                authStatusDiv.innerHTML = '<div class="status warning">‚ö†Ô∏è Usu√°rio n√£o autenticado</div>';
            }
        }

        function createTestUser() {
            log('Criando usu√°rio de teste...', 'info');
            
            const testUser = {
                id: Date.now().toString(),
                email: 'admin@medicare.com',
                name: 'Administrador Teste',
                role: 'admin',
                hospital: 'Hospital Teste',
                isAuthenticated: true
            };
            
            localStorage.setItem('user', JSON.stringify(testUser));
            log('Usu√°rio de teste criado com sucesso', 'success');
            
            checkAuth();
        }

        function clearAuth() {
            log('Limpando autentica√ß√£o...', 'info');
            localStorage.removeItem('user');
            log('Autentica√ß√£o limpa', 'success');
            checkAuth();
        }

        function testDashboard() {
            log('Testando acesso ao dashboard...', 'info');
            
            const dashboardStatusDiv = document.getElementById('dashboard-status');
            
            // Verificar se o servidor est√° rodando
            fetch('http://localhost:8080/')
                .then(response => {
                    if (response.ok) {
                        log('Servidor est√° respondendo', 'success');
                        dashboardStatusDiv.innerHTML = `
                            <div class="status success">‚úÖ Servidor ativo em http://localhost:8080/</div>
                            <div class="status success">‚úÖ Dashboard acess√≠vel</div>
                        `;
                    } else {
                        log(`Servidor respondeu com status: ${response.status}`, 'warning');
                        dashboardStatusDiv.innerHTML = `
                            <div class="status warning">‚ö†Ô∏è Servidor respondeu com status ${response.status}</div>
                        `;
                    }
                })
                .catch(error => {
                    log(`Erro ao acessar servidor: ${error.message}`, 'error');
                    dashboardStatusDiv.innerHTML = `
                        <div class="status error">‚ùå Servidor n√£o est√° respondendo</div>
                        <div class="status error">Erro: ${error.message}</div>
                    `;
                });
        }

        function fixAuthIssues() {
            log('Aplicando corre√ß√µes de autentica√ß√£o...', 'info');
            
            // Verificar e corrigir problemas comuns
            const user = localStorage.getItem('user');
            if (user) {
                try {
                    const userData = JSON.parse(user);
                    if (!userData.isAuthenticated) {
                        userData.isAuthenticated = true;
                        localStorage.setItem('user', JSON.stringify(userData));
                        log('Corrigido: isAuthenticated definido como true', 'success');
                    }
                } catch (error) {
                    log('Criando novo usu√°rio devido a dados corrompidos', 'warning');
                    createTestUser();
                }
            } else {
                log('Criando usu√°rio de teste pois nenhum foi encontrado', 'info');
                createTestUser();
            }
            
            checkAuth();
        }

        function resetSystem() {
            log('Executando reset completo do sistema...', 'info');
            
            // Limpar todos os dados do localStorage
            localStorage.clear();
            log('localStorage limpo', 'success');
            
            // Recriar usu√°rio de teste
            createTestUser();
            
            log('Reset completo executado', 'success');
        }

        function loadSystemInfo() {
            const systemInfoDiv = document.getElementById('system-info');
            
            const info = {
                'URL Atual': window.location.href,
                'User Agent': navigator.userAgent.substring(0, 100) + '...',
                'Timestamp': new Date().toISOString(),
                'LocalStorage Keys': Object.keys(localStorage).join(', ') || 'Nenhuma',
                'Cookies': document.cookie || 'Nenhum'
            };
            
            let infoHTML = '<div class="info-grid">';
            for (const [key, value] of Object.entries(info)) {
                infoHTML += `
                    <div class="info-item">
                        <div class="info-label">${key}:</div>
                        <div class="info-value">${value}</div>
                    </div>
                `;
            }
            infoHTML += '</div>';
            
            systemInfoDiv.innerHTML = infoHTML;
        }

        // Inicializar ao carregar a p√°gina
        window.onload = function() {
            log('P√°gina de debug carregada', 'info');
            checkAuth();
            testDashboard();
            loadSystemInfo();
        };
    </script>
</body>
</html>