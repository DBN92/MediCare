var u=(s,e,o)=>new Promise((d,i)=>{var t=a=>{try{n(o.next(a))}catch(c){i(c)}},l=a=>{try{n(o.throw(a))}catch(c){i(c)}},n=a=>a.done?d(a.value):Promise.resolve(a.value).then(t,l);n((o=o.apply(s,e)).next())});import{T as O}from"./index-CYNMApEz.js";import"./vendor-YT48caDH.js";var y={};const p=y.VITE_GOOGLE_VISION_API_KEY,b="https://vision.googleapis.com/v1/images:annotate",m={medicationNames:/(?:paracetamol|ibuprofeno|dipirona|omeprazol|losartana|metformina|sinvastatina|captopril|hidroclorotiazida|atenolol|amoxicilina|azitromicina|cefalexina|ciprofloxacino|dexametasona|prednisona|insulina|glibenclamida|enalapril|propranolol|furosemida|espironolactona|anlodipino|atorvastatina|rosuvastatina|levotiroxina|carbonato de cálcio|sulfato ferroso|ácido fólico|vitamina d|complexo b)/gi,dosage:/(\d+(?:\.\d+)?)\s*(mg|g|mcg|ml|ui|comprimidos?|cápsulas?|gotas?|colheres?|ampolas?|frascos?|aplicações?)/gi,frequency:/(?:(\d+)x?\s*(?:ao\s*dia|por\s*dia|diário|diária)|(\d+)\s*(?:vezes?\s*ao\s*dia|vezes?\s*por\s*dia)|(?:de\s*)?(\d+)\s*em\s*(\d+)\s*horas?|a\s*cada\s*(\d+)\s*horas?|sos|se\s*necessário)/gi,route:/(?:via\s*)?(oral|sublingual|intramuscular|intravenosa|subcutânea|tópica|oftálmica|otológica|nasal|retal|vaginal|inalatória)/gi,instructions:/(?:tomar|usar|aplicar|administrar)\s*(?:após|antes|durante|com|sem)?\s*(?:as\s*)?(?:refeições?|comida|alimentos?|jejum|deitar|acordar)/gi,prescriber:/(?:dr\.?|dra\.?|doutor|doutora)\s*([a-záàâãéêíóôõúç\s]+)/gi};function v(s){return u(this,null,function*(){var e,o,d,i;if(!p)throw new Error("Google Vision API key not configured");try{const l={requests:[{image:{content:s.replace(/^data:image\/[a-z]+;base64,/,"")},features:[{type:"TEXT_DETECTION",maxResults:1}]}]},n=yield fetch(`${b}?key=${p}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!n.ok)throw new Error(`Google Vision API error: ${n.statusText}`);const a=yield n.json();if((i=(d=(o=(e=a.responses)==null?void 0:e[0])==null?void 0:o.textAnnotations)==null?void 0:d[0])!=null&&i.description){const c=a.responses[0].textAnnotations[0].description;return{success:!0,data:E(c),confidence:a.responses[0].textAnnotations[0].confidence||.8}}else return{success:!1,error:"Nenhum texto detectado na imagem"}}catch(t){return console.error("Google Vision API error:",t),{success:!1,error:`Erro na API do Google Vision: ${t instanceof Error?t.message:"Erro desconhecido"}`}}})}function M(s){return u(this,null,function*(){try{const e=yield O.recognize(s,"por",{logger:o=>console.log(o)});return e.data.text&&e.data.text.trim().length>0?{success:!0,data:E(e.data.text),confidence:e.data.confidence/100}:{success:!1,error:"Nenhum texto detectado na imagem"}}catch(e){return console.error("Tesseract error:",e),{success:!1,error:`Erro no Tesseract: ${e instanceof Error?e.message:"Erro desconhecido"}`}}})}function E(s){const e=s.toLowerCase().replace(/\n/g," ").replace(/\s+/g," "),o=e.match(m.medicationNames),d=o?o[0]:"",i=[...e.matchAll(m.dosage)];let t="",l="";if(i.length>0){const r=i[0];t=r[1],l=r[2]}const n=[...e.matchAll(m.frequency)];let a="";if(n.length>0){const r=n[0];r[1]?a=`${r[1]}x ao dia`:r[2]?a=`${r[2]}x ao dia`:r[3]&&r[4]?a=`de ${r[3]} em ${r[4]} horas`:r[5]?a=`a cada ${r[5]} horas`:(r[0].includes("sos")||r[0].includes("necessário"))&&(a="Se necessário (SOS)")}const c=e.match(m.route),g=c?c[0]:"",f=e.match(m.instructions),T=f?f.join(", "):"",h=[...e.matchAll(m.prescriber)],x=h.length>0?h[0][1].trim():"";return{name:d||"Medicamento não identificado",dosage:t?`${t}${l?" "+l:""}`:"",frequency:a||"1x ao dia",instructions:T||"",activeIngredient:d||"",route:g?I(g):"Oral",prescriber:x?I(x):""}}function I(s){return s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}function P(s){return u(this,null,function*(){var e;try{if(p){console.log("Tentando processar com Google Vision API...");const o=yield v(s);if(o.success&&((e=o.data)!=null&&e.name)&&o.data.name!=="Medicamento não identificado")return o}return console.log("Processando com Tesseract.js..."),yield M(s)}catch(o){return console.error("Erro no processamento OCR:",o),{success:!1,error:`Erro no processamento: ${o instanceof Error?o.message:"Erro desconhecido"}`}}})}function $(){const s=[{name:"Paracetamol",dosage:"500mg",frequency:"3x ao dia",instructions:"Tomar após as refeições",activeIngredient:"Paracetamol",route:"Oral",prescriber:"Dr. João Silva"},{name:"Ibuprofeno",dosage:"400mg",frequency:"2x ao dia",instructions:"Tomar com alimentos",activeIngredient:"Ibuprofeno",route:"Oral",prescriber:"Dra. Maria Santos"},{name:"Omeprazol",dosage:"20mg",frequency:"1x ao dia",instructions:"Tomar em jejum",activeIngredient:"Omeprazol",route:"Oral",prescriber:"Dr. Carlos Oliveira"}];return s[Math.floor(Math.random()*s.length)]}export{$ as getMockMedicationData,P as processMedicationImage};
