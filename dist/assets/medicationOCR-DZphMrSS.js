import{T}from"./index-CYEVOYoE.js";import"./index-ph9s8vf6.js";var O={};const g=O.VITE_GOOGLE_VISION_API_KEY,y="https://vision.googleapis.com/v1/images:annotate",i={medicationNames:/(?:paracetamol|ibuprofeno|dipirona|omeprazol|losartana|metformina|sinvastatina|captopril|hidroclorotiazida|atenolol|amoxicilina|azitromicina|cefalexina|ciprofloxacino|dexametasona|prednisona|insulina|glibenclamida|enalapril|propranolol|furosemida|espironolactona|anlodipino|atorvastatina|rosuvastatina|levotiroxina|carbonato de cálcio|sulfato ferroso|ácido fólico|vitamina d|complexo b)/gi,dosage:/(\d+(?:\.\d+)?)\s*(mg|g|mcg|ml|ui|comprimidos?|cápsulas?|gotas?|colheres?|ampolas?|frascos?|aplicações?)/gi,frequency:/(?:(\d+)x?\s*(?:ao\s*dia|por\s*dia|diário|diária)|(\d+)\s*(?:vezes?\s*ao\s*dia|vezes?\s*por\s*dia)|(?:de\s*)?(\d+)\s*em\s*(\d+)\s*horas?|a\s*cada\s*(\d+)\s*horas?|sos|se\s*necessário)/gi,route:/(?:via\s*)?(oral|sublingual|intramuscular|intravenosa|subcutânea|tópica|oftálmica|otológica|nasal|retal|vaginal|inalatória)/gi,instructions:/(?:tomar|usar|aplicar|administrar)\s*(?:após|antes|durante|com|sem)?\s*(?:as\s*)?(?:refeições?|comida|alimentos?|jejum|deitar|acordar)/gi,prescriber:/(?:dr\.?|dra\.?|doutor|doutora)\s*([a-záàâãéêíóôõúç\s]+)/gi};async function b(s){var e,o,c,d;if(!g)throw new Error("Google Vision API key not configured");try{const l={requests:[{image:{content:s.replace(/^data:image\/[a-z]+;base64,/,"")},features:[{type:"TEXT_DETECTION",maxResults:1}]}]},n=await fetch(`${y}?key=${g}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!n.ok)throw new Error(`Google Vision API error: ${n.statusText}`);const r=await n.json();if((d=(c=(o=(e=r.responses)==null?void 0:e[0])==null?void 0:o.textAnnotations)==null?void 0:c[0])!=null&&d.description){const m=r.responses[0].textAnnotations[0].description;return{success:!0,data:I(m),confidence:r.responses[0].textAnnotations[0].confidence||.8}}else return{success:!1,error:"Nenhum texto detectado na imagem"}}catch(t){return console.error("Google Vision API error:",t),{success:!1,error:`Erro na API do Google Vision: ${t instanceof Error?t.message:"Erro desconhecido"}`}}}async function v(s){try{const e=await T.recognize(s,"por",{logger:o=>console.log(o)});return e.data.text&&e.data.text.trim().length>0?{success:!0,data:I(e.data.text),confidence:e.data.confidence/100}:{success:!1,error:"Nenhum texto detectado na imagem"}}catch(e){return console.error("Tesseract error:",e),{success:!1,error:`Erro no Tesseract: ${e instanceof Error?e.message:"Erro desconhecido"}`}}}function I(s){const e=s.toLowerCase().replace(/\n/g," ").replace(/\s+/g," "),o=e.match(i.medicationNames),c=o?o[0]:"",d=[...e.matchAll(i.dosage)];let t="",l="";if(d.length>0){const a=d[0];t=a[1],l=a[2]}const n=[...e.matchAll(i.frequency)];let r="";if(n.length>0){const a=n[0];a[1]?r=`${a[1]}x ao dia`:a[2]?r=`${a[2]}x ao dia`:a[3]&&a[4]?r=`de ${a[3]} em ${a[4]} horas`:a[5]?r=`a cada ${a[5]} horas`:(a[0].includes("sos")||a[0].includes("necessário"))&&(r="Se necessário (SOS)")}const m=e.match(i.route),u=m?m[0]:"",p=e.match(i.instructions),E=p?p.join(", "):"",f=[...e.matchAll(i.prescriber)],h=f.length>0?f[0][1].trim():"";return{name:c||"Medicamento não identificado",dosage:t?`${t}${l?" "+l:""}`:"",frequency:r||"1x ao dia",instructions:E||"",activeIngredient:c||"",route:u?x(u):"Oral",prescriber:h?x(h):""}}function x(s){return s.charAt(0).toUpperCase()+s.slice(1).toLowerCase()}async function N(s){var e;try{if(g){console.log("Tentando processar com Google Vision API...");const o=await b(s);if(o.success&&((e=o.data)!=null&&e.name)&&o.data.name!=="Medicamento não identificado")return o}return console.log("Processando com Tesseract.js..."),await v(s)}catch(o){return console.error("Erro no processamento OCR:",o),{success:!1,error:`Erro no processamento: ${o instanceof Error?o.message:"Erro desconhecido"}`}}}function _(){const s=[{name:"Paracetamol",dosage:"500mg",frequency:"3x ao dia",instructions:"Tomar após as refeições",activeIngredient:"Paracetamol",route:"Oral",prescriber:"Dr. João Silva"},{name:"Ibuprofeno",dosage:"400mg",frequency:"2x ao dia",instructions:"Tomar com alimentos",activeIngredient:"Ibuprofeno",route:"Oral",prescriber:"Dra. Maria Santos"},{name:"Omeprazol",dosage:"20mg",frequency:"1x ao dia",instructions:"Tomar em jejum",activeIngredient:"Omeprazol",route:"Oral",prescriber:"Dr. Carlos Oliveira"}];return s[Math.floor(Math.random()*s.length)]}export{_ as getMockMedicationData,N as processMedicationImage};
